---
description: Standards for Lagoon Docker Compose configuration
globs: docker-compose.yml
---
# Lagoon Docker Compose Standards

Ensures proper Docker Compose configuration for Lagoon deployments.

<rule>
name: lagoon_docker_compose_standards
description: Enforce standards for Lagoon Docker Compose files
filters:
  - type: file_name
    pattern: "^docker-compose\\.yml$"

actions:
  - type: enforce
    conditions:
      - pattern: "services:\\s+\\w+:\\s+(?!.*labels:[\\s\\S]*lagoon)"
        message: "Add Lagoon labels to service definitions"

      - pattern: "version:\\s*['\"]*2"
        message: "Use Docker Compose format version 3 or higher"

      - pattern: "volumes:\\s+[^:]+:\\s+(?!.*delegated)"
        message: "Consider using 'delegated' mount consistency for better performance"

  - type: suggest
    message: |
      Lagoon Docker Compose Best Practices:
      - Define service types via labels
      - Use proper image naming conventions
      - Configure appropriate volume mounts
      - Set environment-specific variables
      - Define health checks
      - Configure proper networking
      - Set resource constraints
      - Use build arguments appropriately

  - type: validate
    conditions:
      - pattern: "services:\\s+cli:\\s+(?!.*build:)"
        message: "CLI service should have proper build configuration"

      - pattern: "services:\\s+\\w+:\\s+(?!.*depends_on:)"
        message: "Define service dependencies for proper startup order"

      - pattern: "networks:\\s+(?!.*default:)"
        message: "Configure proper network settings for Lagoon compatibility"

metadata:
  priority: high
  version: 1.0
</rule> 